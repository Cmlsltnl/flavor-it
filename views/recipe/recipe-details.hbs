<div class="recipe-details-header">
  {{!-- for header img --}}
</div>


<div class="container-fluid recipe-layout-container">

  <div class="recipe-layout-top row">

    <div class="recipe-img-container col-md-5">
      <img src="{{recipe.image}}" alt="recipe-image" class="recipe-img">
    </div>

    <div class="recipe-layout col-md-7">

      <div class="row align-items-center justify-content-between recipe-title">
        <h1>{{recipe.title}}</h1>
        {{#if isSameUser}}
        <div>
          <a class="btn btn-outline-info" href="/recipe/{{recipe._id}}/edit"> &#9998; Edit Recipe</a>
          <a id="del-recipe-btn" class="btn btn-outline-danger" href="/recipe/{{recipe._id}}/delete"> &#10060; Delete
            Recipe</a>
        </div>
        {{/if}}
      </div>

      <div class="row d-flex align-items-center">
        <div class="recipe-lines">
          <span class="dish-tag-1">{{recipe.dishType}}</span>
        </div>
        <div class="verticalLine"></div>
        <div class="recipe-line">
          <span>cooks in &nbsp;&nbsp; <strong>{{recipe.preparationTime}} min</strong></span>
        </div>
        <div class="verticalLine"></div>
        <div class="recipe-line">
          <span>&nbsp;&nbsp; <strong>{{recipe.portions}}</strong> serves</span>
        </div>
      </div>

      <br>
      <br>

      {{!-- Source --}}
      {{#if isSourceFilled}}
      <div class="row">
        <h6 class="strong">Source / Additional info: </h6>
      </div>
      <div class="row">
        <p>{{recipe.source}}</p>
      </div>
      {{/if}}


      <br>
      <br>

      <div class="row">
        <h6 class="strong">Creator:</h6>
      </div>
      <div class="row">
        <a href="/{{recipe.creator.username}}">
          <a class="btn btn-outline-info" href="/{{recipe.creator.username}}">
            {{recipe.creator.username}}</a>
        </a>
      </div>

      <br>
      <br>

      {{#if loggedIn}}
      {{#unless isSameUser}}
      {{#if isLiking}}
      <div class="row">
        <h5 id="likes">{{recipe.likes}} Likes</h5>
      </div>
      <div class="row">
        <button class="btn btn-danger" id="like-button" title="Like and save the recipe">
          <span id="like-span">&#9829; Like</span>
        </button>
      </div>
      {{else}}
      <div class="row">
        <h5 id="likes">{{recipe.likes}} Likes</h5>
      </div>
      <div class="row">
        <button class="btn btn-outline-danger" id="like-button" title="Like and save the recipe">
          <span id="like-span">&#9829; Like</span>
        </button>
      </div>
      {{/if}}
      {{/unless}}
      {{/if}}

    </div>
  </div>


  <br>
  <br>
  <br>
  <br>

  <div class="form-row recipe-layout-bottom">
    <div class="col-md-4">

      <h3>Ingredients: </h3>

      <ul>
        {{#each recipe.ingredients}}
        <li>{{this.name}} <span> {{this.qty}}</span> <span>{{this.unit}}</span></li>
        {{/each}}
      </ul>

    </div>

    <div id="method" class="col-md-8">
      <h3>Method:</h3>

      <ol>
        {{#each recipe.method}}
        <li>{{this}}</li>
        {{/each}}
      </ol>

    </div>

    {{#if loggedIn}}
    <div class="col-md-4">
      {{!-- for spacing --}}
    </div>
    <div class="col-md-8" id="container">
      <form id="comment-form">
        <label for="comment">Add a comment</label>
        <input type="text" id="comment">
        {{!-- <textarea name="comment" id="comment" cols="50" rows="5"></textarea>
        <button id="add-comment">Add Comment</button> --}}
      </form>

    </div>
    <div class="col-md-4">
      {{!-- for spacing --}}
    </div>
    <div class="col-md-8" id="comment-box">
      {{#if recipe.comments}}
      <h2>Comments</h2>
      {{/if}}
      {{#each recipe.comments}}
      <h4>{{author.username}}</h4>
      <p>{{content}}</p>
      {{/each}}
    </div>
    {{/if}}


  </div>
</div>


<script>
  // Like Button
  let likeButton = document.getElementById('like-button');
  let likes = document.getElementById('likes');

  if (likeButton) {
    likeButton.onclick = () => {
      axios.post("/recipe/like/{{recipe._id}}").then(response => {
        if (response.data.isLiking) {
          likeButton.setAttribute("class", "btn btn-outline-danger");
          likes.innerHTML = `<strong>${response.data.recipe.likes}</strong>` + " Likes";
        } else {
          likeButton.setAttribute("class", "btn btn-danger");
          likes.innerHTML = `<strong>${response.data.recipe.likes}</strong>` + " Likes";
        }
      }).catch(err => {
        console.log(err);
      })
    }
  }

  // delete recipe
  let deleteRecipe = document.getElementById("del-recipe-btn")
  if (deleteRecipe) {
    deleteRecipe.onclick = event => {
      alert("Comfirm to delete this recipe?")
    }
  }

  //comment
  let comment = document.getElementById('comment-form')
  if (comment) {
    comment.onsubmit = event => {
      event.preventDefault();
      axios.post("/recipe/{{recipe._id}}/comment", {
        comment: document.getElementById('comment').value
      }).then(response => {
        let commentContent = '<h2>Comments</h2>';
        response.data.forEach(comment => {
          commentContent += `< h4 > ${comment.author.username}</h4 > <p>${comment.content}<p>`
        })
        document.getElementById("comment-box").innerHTML = commentContent;
        document.getElementById('comment').value = ""
      }).catch(err => {
        console.log(err)
      })
    }
  }

</script>